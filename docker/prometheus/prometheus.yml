# ============================================================================
# DevSkyy Enterprise Platform - Prometheus Configuration
# Version: 5.2.0 | Monitoring & Metrics Collection
# ============================================================================

global:
  scrape_interval: 15s
  scrape_timeout: 10s
  evaluation_interval: 15s
  external_labels:
    cluster: 'devskyy-prod'
    environment: 'production'

# ============================================================================
# Alerting Configuration
# ============================================================================
alerting:
  alertmanagers:
    - static_configs:
        - targets: []
          # - 'alertmanager:9093'  # Uncomment when Alertmanager is deployed

# ============================================================================
# Rule Files
# ============================================================================
rule_files:
  # - 'alerts/*.yml'  # Uncomment when alert rules are created

# ============================================================================
# Scrape Configurations
# ============================================================================
scrape_configs:
  # Prometheus Self-Monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'

  # DevSkyy API Application
  - job_name: 'devskyy-api'
    scrape_interval: 10s
    metrics_path: '/api/v1/monitoring/metrics'
    static_configs:
      - targets: ['api:8000']
        labels:
          service: 'devskyy-api'
          environment: 'production'
    # Truth Protocol Rule #12: P95 < 200ms SLO
    metric_relabel_configs:
      - source_labels: [__name__]
        regex: 'http_request_duration_seconds.*'
        action: keep

  # PostgreSQL Database
  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres:5432']
        labels:
          service: 'postgres'
    # Note: Requires postgres_exporter sidecar

  # Redis Cache
  - job_name: 'redis'
    static_configs:
      - targets: ['redis:6379']
        labels:
          service: 'redis'
    # Note: Requires redis_exporter sidecar

  # Nginx Reverse Proxy
  - job_name: 'nginx'
    static_configs:
      - targets: ['nginx:80']
        labels:
          service: 'nginx'
    # Note: Requires nginx-prometheus-exporter

  # Node Exporter (System Metrics)
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']
        labels:
          service: 'node-exporter'

  # cAdvisor (Container Metrics)
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']
        labels:
          service: 'cadvisor'
    metric_relabel_configs:
      # Keep only container metrics
      - source_labels: [__name__]
        regex: 'container_.*'
        action: keep

# ============================================================================
# Storage Configuration
# ============================================================================
storage:
  tsdb:
    path: /prometheus
    retention:
      time: 30d
      size: 50GB

# ============================================================================
# Remote Write (Optional - for long-term storage)
# ============================================================================
# remote_write:
#   - url: 'https://prometheus-remote-write-endpoint.com/api/v1/write'
#     basic_auth:
#       username: 'your-username'
#       password: 'your-password'

# ============================================================================
# Key Metrics to Monitor (Truth Protocol Rule #12)
# ============================================================================
# Application Performance:
#   - http_request_duration_seconds (P50, P95, P99)
#   - http_requests_total (request count)
#   - http_request_size_bytes
#   - http_response_size_bytes
#
# Error Tracking (Truth Protocol Rule #10):
#   - http_requests_total{status=~"5.."}
#   - error_rate (< 0.5% target)
#
# System Resources:
#   - container_cpu_usage_seconds_total
#   - container_memory_usage_bytes
#   - container_network_receive_bytes_total
#   - container_network_transmit_bytes_total
#
# Database Performance:
#   - pg_stat_database_numbackends (connection count)
#   - pg_stat_database_xact_commit (transaction rate)
#   - pg_stat_database_blks_hit (cache hit ratio)
#
# Cache Performance:
#   - redis_connected_clients
#   - redis_keyspace_hits_total
#   - redis_keyspace_misses_total
# ============================================================================
