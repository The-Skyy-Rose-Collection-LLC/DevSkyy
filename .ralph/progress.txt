# Ralph Progress Log - Interactive Collection Pages
Started: 2026-01-11
Project: DevSkyy Interactive Collection Pages for SkyyRose
---

## Codebase Patterns
- Use Context7 for all library documentation research (resolve-library-id → query-docs)
- Use Serena for all codebase navigation (find_symbol, search_for_pattern, read_file)
- TypeScript strict mode enabled - all code must pass mypy
- Three.js scenes in src/collections/ - lazy-load for performance
- WordPress integration via wordpress/ client (BrandKit pattern)
- 2D/2.5D assets in assets/2d-25d-assets/ with CSS classes for effects
- SkyyRose brand DNA: primary #B76E79, luxury + rebellious
- Ralph workflow: ONE story at a time → implement → test → commit → update PRD → append progress
---

## [2026-01-11] - COLL-001: Base Collection Layout Component

**What was implemented:**
- Created foundational React component for collection pages
- Implemented luxury brand styling with inline styles (codebase pattern)
- Built responsive layout with hero, 3D experience, product grid, and story sections
- Defined TypeScript interfaces for Collection, CollectionTheme, Product
- Created COLLECTIONS constant with BLACK_ROSE, SIGNATURE, LOVE_HURTS configurations

**Files changed:**
- `src/components/collections/CollectionLayout.tsx` (NEW) - Main layout component
- `src/types/collections.ts` (NEW) - TypeScript interfaces and collection data
- `.ralph/prd-interactive-collections.json` - Marked COLL-001 as passes: true
- `.serena/memories/interactive_collection_pages_requirements.md` - User requirements reference

**Learnings for future iterations:**
- **Inline styles pattern**: DevSkyy uses inline style objects (not CSS-in-JS). See CartModal.tsx for reference.
- **Responsive typography**: Use clamp() for fluid responsive text (e.g., `clamp(3rem, 8vw, 6rem)`)
- **Collection theming**: Each collection has primaryColor, backgroundColor, textColor, accentColor
- **Component structure**: Hero (100vh) → 3D Experience → Products → Story (vertical flow)
- **Brand colors**: BLACK_ROSE (#1a1a1a), SIGNATURE (#d4af37 gold), LOVE_HURTS (#b76e79 rose)
- **Type-safety**: All collection data is strongly typed with interfaces exported from types/collections.ts
- **Three.js integration**: Experience components passed as ReactNode props for flexibility

**TypeScript checks:** ✅ PASSED
**Pre-commit hooks:** ✅ PASSED (after linting fixes)
**Commit:** feat: COLL-001 - Create base collection layout component (725103a39)

---

## [2026-01-11] - COLL-002: BLACK ROSE Three.js Integration

**What was implemented:**
- Created BlackRoseCanvas.tsx - React wrapper component with lazy loading
- Created RotatingBlackRoseLogo.tsx - CSS 3D rotating logo for header
- Enhanced BlackRoseExperience.ts with night sky and moving clouds
- Implemented fullscreen toggle button with smooth transitions
- Added error handling and loading states for 3D scene

**Files changed:**
- `src/components/collections/BlackRoseCanvas.tsx` (NEW) - React component wrapper
- `src/components/collections/RotatingBlackRoseLogo.tsx` (NEW) - Rotating header logo
- `src/collections/BlackRoseExperience.ts` (MODIFIED) - Added night sky + clouds
- `.ralph/prd-interactive-collections.json` - Marked COLL-002 as passes: true

**Learnings for future iterations:**
- **Lazy loading pattern**: Use dynamic import `await import('../../collections/BlackRoseExperience')` for code-splitting
- **Night sky shader**: SphereGeometry(500) + ShaderMaterial(BackSide) with vertical gradient (topColor: #0a0a1a, bottomColor: #000000)
- **Moving clouds**: Canvas-based sprite textures with radial gradient, 12 sprites, wrap-around at ±50 units
- **CSS 3D rotation**: `transform-style: preserve-3d` + `rotateY(360deg)` animation for logo
- **Fullscreen API**: Use `requestFullscreen()` / `exitFullscreen()` with error handling
- **Three.js disposal**: Must dispose nightSky mesh, cloud sprites, and their materials/textures
- **Cloud animation**: Update cloud.position in animate loop, wrap coordinates for infinite effect
- **Shader uniforms**: topColor/bottomColor/offset/exponent control gradient appearance

**TypeScript checks:** ✅ PASSED
**Pre-commit hooks:** ✅ PASSED (after whitespace fixes)
**Commit:** feat: COLL-002 - BLACK ROSE Three.js integration (f35483982)

---

## [2026-01-11] - COLL-003: WordPress API Product Fetching

**What was implemented:**
- Created useCollectionProducts React hook for fetching products
- Implemented in-memory caching with 5 min TTL
- Added automatic retry with exponential backoff (1s, 2s, 3s)
- Created WooCommerce API endpoints in api/wordpress.py
- Added category resolution (slug → ID conversion)
- Implemented loading and error states with manual retry/refetch

**Files changed:**
- `src/hooks/useCollectionProducts.ts` (NEW) - React hook with caching
- `api/wordpress.py` (MODIFIED) - Added WooCommerce product endpoints
- `.ralph/prd-interactive-collections.json` - Marked COLL-003 as passes: true

**Learnings for future iterations:**
- **React hook caching**: Use Map<string, CacheEntry> shared across instances, check timestamp vs TTL
- **Retry pattern**: useRef for retry count, setTimeout with exponential backoff (1000 * retryCount)
- **Category resolution**: Must fetch all categories first, find by slug, then use ID for product filter
- **API structure**: Backend at `/api/v1/wordpress/products` proxies to WooCommerceProducts class
- **Cleanup pattern**: useRef(isMounted) to prevent state updates after unmount
- **Cache bypass**: refetch() bypasses cache by passing bypassCache=true flag
- **Error handling**: Retry only on failure (not on category not found), max 3 attempts
- **TypeScript Product interface**: Already exists in types/collections.ts (reused)

**API Endpoints Added:**
- GET `/wordpress/products/categories` - List all WooCommerce categories
- GET `/wordpress/products?category=ID&per_page=20&status=publish` - List products
- GET `/wordpress/products/{id}` - Get single product

**TypeScript checks:** ✅ PASSED
**Pre-commit hooks:** ✅ PASSED (after ruff format)
**Commit:** feat: COLL-003 - WordPress API product fetching (a0f25aa3a)

---
