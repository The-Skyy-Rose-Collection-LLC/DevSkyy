{
  "PreToolUse": [
    {
      "matcher": "Write|Edit",
      "hooks": [
        {
          "type": "prompt",
          "prompt": "SECURITY VALIDATION - DevSkyy Production Standards\n\nAnalyze this file operation for security risks:\n\nFile path: $TOOL_INPUT\n\nCHECK FOR:\n1. **Secrets & Credentials**: .env, .env.*, credentials.json, secrets.*, *.key, *.pem, id_rsa\n2. **Path Traversal**: Patterns like ../ or absolute paths outside project\n3. **Placeholder Code**: 'TODO', 'FIXME', 'placeholder', 'stub', 'mock' (violates DevSkyy ABSOLUTE RULES)\n4. **Hardcoded Secrets**: API keys (sk-, pk-), passwords, tokens in code\n5. **Sensitive Directories**: .git/config, .ssh/, node_modules/.env\n\nDEVSKYY POLICY:\n- NO placeholders/stubs allowed in production code\n- NO hardcoded credentials ever\n- NO modifications to .env files (use environment management)\n\nOUTPUT FORMAT:\n{\n  \"hookSpecificOutput\": {\n    \"permissionDecision\": \"allow|deny|ask\",\n    \"updatedInput\": null\n  },\n  \"systemMessage\": \"Brief explanation of decision\"\n}\n\nIf DENY: Explain which rule was violated.\nIf ASK: Explain the risk and request user confirmation.",
          "timeout": 30
        }
      ]
    },
    {
      "matcher": "Bash",
      "hooks": [
        {
          "type": "command",
          "command": "bash .claude/hooks/scripts/validate-bash.sh",
          "timeout": 10
        }
      ]
    },
    {
      "matcher": "mcp__.*__delete.*|mcp__.*__destroy.*",
      "hooks": [
        {
          "type": "prompt",
          "prompt": "DESTRUCTIVE OPERATION WARNING\n\nTool: $TOOL_NAME\nInput: $TOOL_INPUT\n\nThis is a DESTRUCTIVE operation. Verify:\n1. User explicitly requested deletion\n2. Not deleting production data\n3. Backup exists if needed\n4. Operation is reversible or acceptable\n\nReturn 'ask' to request user confirmation, 'deny' if clearly unsafe.",
          "timeout": 20
        }
      ]
    }
  ],
  "PostToolUse": [
    {
      "matcher": "*",
      "hooks": [
        {
          "type": "command",
          "command": "bash .claude/hooks/scripts/audit-log.sh",
          "timeout": 5
        }
      ]
    },
    {
      "matcher": "Write|Edit",
      "hooks": [
        {
          "type": "prompt",
          "prompt": "CODE QUALITY VALIDATION - Post-Write Analysis\n\nFile modified: $TOOL_INPUT\nResult: $TOOL_RESULT\n\nAnalyze for:\n1. **Syntax errors**: Missing brackets, quotes, invalid syntax\n2. **Security issues**: SQL injection risks, XSS, command injection\n3. **Type safety**: Missing type hints (DevSkyy requires type hints everywhere)\n4. **Breaking changes**: Modified function signatures without updating callers\n5. **Import errors**: Missing imports for new code\n\nIf issues found, provide actionable feedback to Claude.\nIf code looks good, output empty systemMessage.\n\nOUTPUT:\n{\n  \"continue\": true,\n  \"systemMessage\": \"Issues found (if any) or empty string\"\n}",
          "timeout": 30
        }
      ]
    }
  ],
  "Stop": [
    {
      "matcher": "*",
      "hooks": [
        {
          "type": "prompt",
          "prompt": "TDD & QUALITY GATE ENFORCEMENT - DevSkyy Completion Checklist\n\nBefore allowing task completion, verify ALL requirements:\n\n**MANDATORY (BLOCK if missing):**\n□ Tests exist for new code (TDD requirement)\n□ Code formatting applied: isort && ruff --fix && black\n□ No TODO, FIXME, placeholder, stub, or mock code\n□ No hardcoded credentials or API keys\n□ Type hints present on all functions/methods\n\n**STRONGLY RECOMMENDED (WARN if missing):**\n□ Tests actually run (pytest output visible)\n□ Build succeeded (if applicable)\n□ Documentation updated (if public API changed)\n□ Error handling present (no bare except:)\n\n**EVALUATION:**\n1. Review transcript for evidence of:\n   - pytest execution\n   - formatting commands (isort/ruff/black)\n   - No creation of stub/placeholder code\n2. Check if user's request is fully answered\n\nOUTPUT FORMAT:\n{\n  \"decision\": \"approve|block\",\n  \"reason\": \"Detailed explanation of decision\",\n  \"systemMessage\": \"Missing items (if blocked) or approval confirmation\"\n}\n\nBLOCK if mandatory items missing. Provide specific remediation steps.",
          "timeout": 45
        }
      ]
    }
  ],
  "SessionStart": [
    {
      "matcher": "*",
      "hooks": [
        {
          "type": "command",
          "command": "bash .claude/hooks/scripts/load-context.sh",
          "timeout": 15
        }
      ]
    }
  ],
  "UserPromptSubmit": [
    {
      "matcher": "*",
      "hooks": [
        {
          "type": "prompt",
          "prompt": "USER REQUEST ANALYSIS - DevSkyy Policy Enforcement\n\nUser prompt: $USER_PROMPT\n\nCheck for policy violations:\n\n1. **Placeholder Code Requests**: If user asks to 'stub out', 'add TODO', 'placeholder for now'\n   → WARN: DevSkyy prohibits placeholders (ABSOLUTE RULES)\n   → Suggest full implementation instead\n\n2. **Security Anti-patterns**: Requests to disable security, hardcode credentials, skip validation\n   → WARN: Security violation, suggest proper approach\n\n3. **Test Skipping**: 'Skip tests for now', 'we'll add tests later'\n   → WARN: TDD is mandatory (ABSOLUTE RULES)\n\n4. **Feature Deletion**: Request to remove capabilities\n   → WARN: 'No Feature Deletions' rule, suggest refactor instead\n\nIf violations detected, inject warning into context.\nOtherwise, output empty systemMessage.\n\nOUTPUT:\n{\n  \"continue\": true,\n  \"systemMessage\": \"Policy warning (if applicable) or empty string\"\n}",
          "timeout": 20
        }
      ]
    }
  ]
}
