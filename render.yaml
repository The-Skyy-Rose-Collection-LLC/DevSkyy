# Render Blueprint - DevSkyy Backend
# ==================================
# Deploy: https://dashboard.render.com/blueprints
# 1. Connect your GitHub repo: The-Skyy-Rose-Collection-LLC/DevSkyy
# 2. Render auto-detects this file
# 3. Set API keys in Render Dashboard > Environment after deploy
#
# Docs: docs/deployment/RENDER_DEPLOYMENT_GUIDE.md
# Quick Start: docs/deployment/RENDER_QUICKSTART.md

services:
  - type: web
    name: devskyy-api
    runtime: python
    region: oregon  # Options: oregon, frankfurt, singapore, ohio, virginia
    plan: starter   # Options: free, starter ($7/mo), standard ($25/mo), pro ($85/mo)
    branch: main
    buildCommand: pip install --upgrade pip && pip install -r requirements.txt
    startCommand: gunicorn main_enterprise:app --bind 0.0.0.0:$PORT --workers 2 --worker-class uvicorn.workers.UvicornWorker --timeout 120 --access-logfile - --error-logfile -
    healthCheckPath: /health
    autoDeploy: true

    # Environment Variables
    # =====================
    # CRITICAL: Additional environment variables MUST be set in Render Dashboard
    # after deployment. See docs/deployment/RENDER_QUICKSTART.md for full list.
    envVars:
      # Python Runtime
      - key: PYTHON_VERSION
        value: "3.11.11"

      # Application Settings
      - key: ENVIRONMENT
        value: production

      - key: DEBUG
        value: false

      - key: LOG_LEVEL
        value: INFO

      # CORS Configuration
      # Production domains for app.devskyy.app
      - key: CORS_ORIGINS
        value: https://app.devskyy.app,https://api.devskyy.app,https://devskyy-dashboard.vercel.app,http://localhost:3000

      # Security Secrets (Auto-generated by Render)
      # These are automatically generated secure random values
      - key: JWT_SECRET_KEY
        generateValue: true

      - key: ENCRYPTION_MASTER_KEY
        generateValue: true

      # Database Connection Pool Settings
      # Optimized for Render Starter plan
      - key: DB_POOL_SIZE
        value: "10"

      - key: DB_MAX_OVERFLOW
        value: "5"

      - key: DB_POOL_TIMEOUT
        value: "30"

      - key: DB_POOL_RECYCLE
        value: "3600"

      # Redis Settings
      - key: REDIS_MAX_CONNECTIONS
        value: "50"

      - key: REDIS_SOCKET_TIMEOUT
        value: "5"

      # Performance & Features
      - key: ENABLE_CACHE
        value: "true"

      - key: ENABLE_METRICS
        value: "true"

      - key: ENABLE_3D_GENERATION
        value: "true"

      # Rate Limiting
      - key: RATE_LIMIT_PER_MINUTE
        value: "60"

      - key: RATE_LIMIT_PER_HOUR
        value: "1000"

      # ⚠️  REQUIRED: Set these manually in Render Dashboard after deployment
      # ==================================================================
      # These cannot be auto-generated and must be added manually:
      #
      # DATABASE & CACHE (Required):
      #   - DATABASE_URL: Get from PostgreSQL service (Internal URL)
      #   - REDIS_URL: Get from Redis service (Internal URL)
      #
      # LLM PROVIDER (At least ONE required):
      #   - OPENAI_API_KEY: From platform.openai.com/api-keys
      #   - ANTHROPIC_API_KEY: From console.anthropic.com/settings/keys
      #   - GOOGLE_AI_API_KEY: From makersuite.google.com/app/apikey
      #
      # OPTIONAL - 3D Generation:
      #   - TRIPO_API_KEY: From platform.tripo3d.ai
      #   - FASHN_API_KEY: From fashn.ai
      #   - HUGGINGFACE_ACCESS_TOKEN: From huggingface.co/settings/tokens
      #
      # OPTIONAL - WordPress/WooCommerce:
      #   - WORDPRESS_URL: Your WordPress site URL
      #   - WOOCOMMERCE_KEY: WooCommerce consumer key
      #   - WOOCOMMERCE_SECRET: WooCommerce consumer secret
      #
      # See full list: docs/deployment/RENDER_QUICKSTART.md

# PostgreSQL Database Configuration
# ==================================
# Create this service first in Render Dashboard, then add the Internal URL
# to the web service environment variables as DATABASE_URL
#
# Recommended Configuration:
#   Name:              devskyy-postgres
#   Database:          devskyy_production
#   Region:            oregon (match web service region)
#   PostgreSQL Version: 16
#   Plan:              Standard ($7/month minimum for production)
#
# After creation, copy the Internal Database URL to the web service:
#   DATABASE_URL=postgresql://devskyy:***@dpg-***/devskyy_production

# Redis Configuration
# ===================
# Create this service in Render Dashboard, then add the Internal URL
# to the web service environment variables as REDIS_URL
#
# Recommended Configuration:
#   Name:              devskyy-redis
#   Region:            oregon (match web service region)
#   Plan:              Standard ($7/month minimum for production)
#   Max Memory Policy: allkeys-lru (evict least recently used)
#
# After creation, copy the Internal Redis URL to the web service:
#   REDIS_URL=redis://red-***:6379

# Deployment Notes
# ================
# - First deployment takes 5-10 minutes
# - Render automatically provisions SSL certificates (Let's Encrypt)
# - Auto-deploy triggers on every push to main branch
# - Health checks run every 30 seconds at /health endpoint
# - Service auto-restarts on 3 consecutive health check failures
#
# Custom Domain Setup:
#   1. Add custom domain in Render Dashboard > Settings
#   2. Add CNAME record in your DNS provider
#   3. SSL certificate auto-provisions in 2-5 minutes
#   4. Update CORS_ORIGINS environment variable
#
# Cost Estimate (Recommended Production Setup):
#   - Web Service (Starter):     $7/month
#   - PostgreSQL (Standard):     $7/month
#   - Redis (Standard):          $7/month
#   - Total:                     $21/month
#
# Monitoring:
#   - View metrics: Dashboard > Metrics tab
#   - Stream logs: Dashboard > Logs tab
#   - Configure alerts: Dashboard > Settings > Notifications
#
# Support:
#   - Documentation: docs/deployment/RENDER_DEPLOYMENT_GUIDE.md
#   - Render Support: support@render.com
#   - GitHub Issues: github.com/The-Skyy-Rose-Collection-LLC/DevSkyy/issues
