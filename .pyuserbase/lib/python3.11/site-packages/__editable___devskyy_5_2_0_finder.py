from __future__ import annotations
import sys
from importlib.machinery import ModuleSpec, PathFinder
from importlib.machinery import all_suffixes as module_suffixes
from importlib.util import spec_from_file_location
from itertools import chain
from pathlib import Path

MAPPING: dict[str, str] = {'agent': '/Users/coreyfoster/Downloads/DevSkyy-main 2/agent', 'ai': '/Users/coreyfoster/Downloads/DevSkyy-main 2/ai', 'ai_orchestration': '/Users/coreyfoster/Downloads/DevSkyy-main 2/ai_orchestration', 'api': '/Users/coreyfoster/Downloads/DevSkyy-main 2/api', 'api_integration': '/Users/coreyfoster/Downloads/DevSkyy-main 2/api_integration', 'architecture': '/Users/coreyfoster/Downloads/DevSkyy-main 2/architecture', 'auth0': '/Users/coreyfoster/Downloads/DevSkyy-main 2/auth0', 'backend': '/Users/coreyfoster/Downloads/DevSkyy-main 2/backend', 'config': '/Users/coreyfoster/Downloads/DevSkyy-main 2/config', 'database': '/Users/coreyfoster/Downloads/DevSkyy-main 2/database', 'deployment': '/Users/coreyfoster/Downloads/DevSkyy-main 2/deployment', 'examples': '/Users/coreyfoster/Downloads/DevSkyy-main 2/examples', 'fashion': '/Users/coreyfoster/Downloads/DevSkyy-main 2/fashion', 'fashion-ai-repo': '/Users/coreyfoster/Downloads/DevSkyy-main 2/fashion-ai-repo', 'fashion_ai_bounded_autonomy': '/Users/coreyfoster/Downloads/DevSkyy-main 2/fashion_ai_bounded_autonomy', 'infrastructure': '/Users/coreyfoster/Downloads/DevSkyy-main 2/infrastructure', 'intelligence': '/Users/coreyfoster/Downloads/DevSkyy-main 2/intelligence', 'kubernetes': '/Users/coreyfoster/Downloads/DevSkyy-main 2/kubernetes', 'ml': '/Users/coreyfoster/Downloads/DevSkyy-main 2/ml', 'monitoring': '/Users/coreyfoster/Downloads/DevSkyy-main 2/monitoring', 'scripts': '/Users/coreyfoster/Downloads/DevSkyy-main 2/scripts', 'security': '/Users/coreyfoster/Downloads/DevSkyy-main 2/security', 'security_integration_backup_20251026_175434': '/Users/coreyfoster/Downloads/DevSkyy-main 2/security_integration_backup_20251026_175434', 'skyy-rose-collection-EMERGENCY-FIX': '/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-EMERGENCY-FIX', 'skyy-rose-collection-theme-package': '/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-theme-package', 'skyy-rose-collection-with-logo': '/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-with-logo', 'staging': '/Users/coreyfoster/Downloads/DevSkyy-main 2/staging', 'templates': '/Users/coreyfoster/Downloads/DevSkyy-main 2/templates', 'tools': '/Users/coreyfoster/Downloads/DevSkyy-main 2/tools', 'uploads': '/Users/coreyfoster/Downloads/DevSkyy-main 2/uploads', 'webhooks': '/Users/coreyfoster/Downloads/DevSkyy-main 2/webhooks', 'wordpress-mastery': '/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery', 'wordpress-plugin': '/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-plugin'}
NAMESPACES: dict[str, list[str]] = {'database': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/database'], 'tools': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/tools'], 'staging': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/staging'], 'intelligence': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/intelligence'], 'wordpress-plugin': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-plugin'], 'fashion-ai-repo': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/fashion-ai-repo'], 'uploads': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/uploads'], 'fashion': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/fashion'], 'ai_orchestration': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/ai_orchestration'], 'wordpress-mastery': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery'], 'ai': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/ai'], 'deployment': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/deployment'], 'api_integration': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/api_integration'], 'examples': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/examples'], 'scripts': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/scripts'], 'skyy-rose-collection-EMERGENCY-FIX': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-EMERGENCY-FIX'], 'skyy-rose-collection-with-logo': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-with-logo'], 'security_integration_backup_20251026_175434': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/security_integration_backup_20251026_175434'], 'skyy-rose-collection-theme-package': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-theme-package'], 'kubernetes': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/kubernetes'], 'infrastructure': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/infrastructure'], 'auth0': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/auth0'], 'staging.themes': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/staging/themes'], 'staging.themes.deployed': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/staging/themes/deployed'], 'staging.themes.deployed.skyy-rose-minimal-working': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/staging/themes/deployed/skyy-rose-minimal-working'], 'staging.themes.deployed.skyy-rose-luxury-corrected-2024': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/staging/themes/deployed/skyy-rose-luxury-corrected-2024'], 'staging.themes.deployed.skyy-rose-luxury-fixed-2024': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/staging/themes/deployed/skyy-rose-luxury-fixed-2024'], 'staging.themes.deployed.skyy-rose-luxury-collection-2024': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/staging/themes/deployed/skyy-rose-luxury-collection-2024'], 'fashion_ai_bounded_autonomy.config': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/fashion_ai_bounded_autonomy/config'], 'fashion_ai_bounded_autonomy.examples': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/fashion_ai_bounded_autonomy/examples'], 'wordpress-plugin.includes': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-plugin/includes'], 'wordpress-plugin.admin': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-plugin/admin'], 'wordpress-plugin.includes.agents': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-plugin/includes/agents'], 'wordpress-plugin.includes.api': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-plugin/includes/api'], 'wordpress-plugin.admin.css': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-plugin/admin/css'], 'wordpress-plugin.admin.js': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-plugin/admin/js'], 'fashion-ai-repo.artifacts': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/fashion-ai-repo/artifacts'], 'fashion-ai-repo.config': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/fashion-ai-repo/config'], 'fashion-ai-repo.docs': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/fashion-ai-repo/docs'], 'fashion-ai-repo.scripts': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/fashion-ai-repo/scripts'], 'uploads.training_data': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/uploads/training_data'], 'uploads.training_data.general': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/uploads/training_data/general'], 'ml.registry': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/ml/registry'], 'wordpress-mastery.error-logs': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery/error-logs'], 'wordpress-mastery.docker': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery/docker'], 'wordpress-mastery.testing': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery/testing'], 'wordpress-mastery.templates': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery/templates'], 'wordpress-mastery.intellectual-property': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery/intellectual-property'], 'wordpress-mastery.standards': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery/standards'], 'wordpress-mastery.docker.ai-services': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery/docker/ai-services'], 'wordpress-mastery.templates.theme-boilerplate': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery/templates/theme-boilerplate'], 'wordpress-mastery.templates.woocommerce-luxury': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery/templates/woocommerce-luxury'], 'wordpress-mastery.templates.woocommerce-luxury.woocommerce': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery/templates/woocommerce-luxury/woocommerce'], 'wordpress-mastery.templates.woocommerce-luxury.assets': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery/templates/woocommerce-luxury/assets'], 'wordpress-mastery.templates.woocommerce-luxury.woocommerce.myaccount': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery/templates/woocommerce-luxury/woocommerce/myaccount'], 'wordpress-mastery.templates.woocommerce-luxury.woocommerce.checkout': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery/templates/woocommerce-luxury/woocommerce/checkout'], 'wordpress-mastery.templates.woocommerce-luxury.woocommerce.cart': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery/templates/woocommerce-luxury/woocommerce/cart'], 'wordpress-mastery.templates.woocommerce-luxury.assets.images': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery/templates/woocommerce-luxury/assets/images'], 'wordpress-mastery.templates.woocommerce-luxury.assets.js': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/wordpress-mastery/templates/woocommerce-luxury/assets/js'], 'deployment.kubernetes': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/deployment/kubernetes'], 'skyy-rose-collection-EMERGENCY-FIX.woocommerce': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-EMERGENCY-FIX/woocommerce'], 'skyy-rose-collection-EMERGENCY-FIX.assets': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-EMERGENCY-FIX/assets'], 'skyy-rose-collection-EMERGENCY-FIX.woocommerce.myaccount': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-EMERGENCY-FIX/woocommerce/myaccount'], 'skyy-rose-collection-EMERGENCY-FIX.woocommerce.checkout': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-EMERGENCY-FIX/woocommerce/checkout'], 'skyy-rose-collection-EMERGENCY-FIX.woocommerce.cart': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-EMERGENCY-FIX/woocommerce/cart'], 'skyy-rose-collection-EMERGENCY-FIX.assets.js': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-EMERGENCY-FIX/assets/js'], 'skyy-rose-collection-with-logo.woocommerce': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-with-logo/woocommerce'], 'skyy-rose-collection-with-logo.assets': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-with-logo/assets'], 'skyy-rose-collection-with-logo.woocommerce.myaccount': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-with-logo/woocommerce/myaccount'], 'skyy-rose-collection-with-logo.woocommerce.checkout': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-with-logo/woocommerce/checkout'], 'skyy-rose-collection-with-logo.woocommerce.cart': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-with-logo/woocommerce/cart'], 'skyy-rose-collection-with-logo.assets.images': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-with-logo/assets/images'], 'skyy-rose-collection-with-logo.assets.js': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-with-logo/assets/js'], 'skyy-rose-collection-theme-package.woocommerce': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-theme-package/woocommerce'], 'skyy-rose-collection-theme-package.assets': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-theme-package/assets'], 'skyy-rose-collection-theme-package.woocommerce.myaccount': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-theme-package/woocommerce/myaccount'], 'skyy-rose-collection-theme-package.woocommerce.checkout': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-theme-package/woocommerce/checkout'], 'skyy-rose-collection-theme-package.woocommerce.cart': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-theme-package/woocommerce/cart'], 'skyy-rose-collection-theme-package.assets.js': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/skyy-rose-collection-theme-package/assets/js'], 'kubernetes.production': ['/Users/coreyfoster/Downloads/DevSkyy-main 2/kubernetes/production']}
PATH_PLACEHOLDER = '__editable__.devskyy-5.2.0.finder' + ".__path_hook__"


class _EditableFinder:  # MetaPathFinder
    @classmethod
    def find_spec(cls, fullname: str, path=None, target=None) -> ModuleSpec | None:  # type: ignore
        # Top-level packages and modules (we know these exist in the FS)
        if fullname in MAPPING:
            pkg_path = MAPPING[fullname]
            return cls._find_spec(fullname, Path(pkg_path))

        # Handle immediate children modules (required for namespaces to work)
        # To avoid problems with case sensitivity in the file system we delegate
        # to the importlib.machinery implementation.
        parent, _, child = fullname.rpartition(".")
        if parent and parent in MAPPING:
            return PathFinder.find_spec(fullname, path=[MAPPING[parent]])

        # Other levels of nesting should be handled automatically by importlib
        # using the parent path.
        return None

    @classmethod
    def _find_spec(cls, fullname: str, candidate_path: Path) -> ModuleSpec | None:
        init = candidate_path / "__init__.py"
        candidates = (candidate_path.with_suffix(x) for x in module_suffixes())
        for candidate in chain([init], candidates):
            if candidate.exists():
                return spec_from_file_location(fullname, candidate)
        return None


class _EditableNamespaceFinder:  # PathEntryFinder
    @classmethod
    def _path_hook(cls, path) -> type[_EditableNamespaceFinder]:
        if path == PATH_PLACEHOLDER:
            return cls
        raise ImportError

    @classmethod
    def _paths(cls, fullname: str) -> list[str]:
        paths = NAMESPACES[fullname]
        if not paths and fullname in MAPPING:
            paths = [MAPPING[fullname]]
        # Always add placeholder, for 2 reasons:
        # 1. __path__ cannot be empty for the spec to be considered namespace.
        # 2. In the case of nested namespaces, we need to force
        #    import machinery to query _EditableNamespaceFinder again.
        return [*paths, PATH_PLACEHOLDER]

    @classmethod
    def find_spec(cls, fullname: str, target=None) -> ModuleSpec | None:  # type: ignore
        if fullname in NAMESPACES:
            spec = ModuleSpec(fullname, None, is_package=True)
            spec.submodule_search_locations = cls._paths(fullname)
            return spec
        return None

    @classmethod
    def find_module(cls, _fullname) -> None:
        return None


def install():
    if not any(finder == _EditableFinder for finder in sys.meta_path):
        sys.meta_path.append(_EditableFinder)

    if not NAMESPACES:
        return

    if not any(hook == _EditableNamespaceFinder._path_hook for hook in sys.path_hooks):
        # PathEntryFinder is needed to create NamespaceSpec without private APIS
        sys.path_hooks.append(_EditableNamespaceFinder._path_hook)
    if PATH_PLACEHOLDER not in sys.path:
        sys.path.append(PATH_PLACEHOLDER)  # Used just to trigger the path hook
